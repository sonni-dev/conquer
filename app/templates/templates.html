{% extends "base.html" %}

{% block title %}Templates - Conquer{% endblock %}

{% block content %}
<div class="templates-page">
    <h1>ðŸ“š Quest Templates</h1>
    <p class="subtitle">Choose a template and select your energy level to add it to today</p>

    <!-- Filters -->
    <div class="templates-filters">
        <a href="{{ url_for('templates_list') }}" 
           class="filter-link {% if not selected_category %}active{% endif %}">
            All Categories
        </a>
        {% for category in categories %}
        <a href="{{ url_for('templates_list', category=category) }}" 
           class="filter-link {% if selected_category == category %}active{% endif %}">
            {{ category }}
        </a>
        {% endfor %}
    </div>

    <!-- Templates Grid -->
    <div class="templates-grid">
        {% if templates %}
            {% for template in templates %}
            <div class="template-card">
                <div class="template-header">
                    <h3>{{ template.title }}</h3>
                    <span class="template-category">{{ template.category }}</span>
                </div>
                
                <div class="template-info">
                    <div class="template-tags">
                        <span class="tag tag-type">{{ template.task_type }}</span>
                        {% if template.effort_type %}
                        <span class="tag tag-effort">{{ template.effort_type }}</span>
                        {% endif %}
                        {% if template.location_type %}
                        <span class="tag tag-location">{{ template.location_type }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="template-subtasks">
                        <strong>{{ template.subtasks|length }} subtasks:</strong>
                        <ul>
                            {% for subtask in template.subtasks[:3] %}
                            <li>
                                <span class="subtask-level">L{{ subtask.level }}</span>
                                {{ subtask.description }}
                            </li>
                            {% endfor %}
                            {% if template.subtasks|length > 3 %}
                            <li class="more-indicator">+ {{ template.subtasks|length - 3 }} more...</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                
                <div class="template-actions">
                    <div class="tier-selector">
                        <p class="tier-prompt">Choose your energy:</p>
                        <div class="tier-buttons">
                            <form method="POST" action="{{ url_for('add_task_from_template', template_id=template.id) }}" style="display: inline;">
                                <input type="hidden" name="tier" value="1">
                                <button type="submit" class="tier-btn low">
                                    ðŸŒ™ Low<br><span class="tier-xp">~{{ template.base_xp_low }} XP</span>
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('add_task_from_template', template_id=template.id) }}" style="display: inline;">
                                <input type="hidden" name="tier" value="2">
                                <button type="submit" class="tier-btn medium">
                                    âš¡ Medium<br><span class="tier-xp">~{{ template.base_xp_medium }} XP</span>
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('add_task_from_template', template_id=template.id) }}" style="display: inline;">
                                <input type="hidden" name="tier" value="3">
                                <button type="submit" class="tier-btn high">
                                    ðŸ”¥ High<br><span class="tier-xp">~{{ template.base_xp_high }} XP</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <a href="{{ url_for('edit_template', template_id=template.id) }}" class="btn-secondary btn-small">
                        Edit Template
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state-large">
                <p>No templates found.</p>
                <a href="{{ url_for('create_template') }}" class="btn-primary">Create Your First Template</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
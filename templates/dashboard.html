{% extends "base.html" %}

{% block title %}Dashboard - Conquer{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Progress Section -->
    <div class="progress-section">
        <div class="level-card">
            <div class="level-badge">
                <span class="level-number">{{ progress.current_level }}</span>
                <span class="level-label">Level</span>
            </div>
            <div class="xp-container">
                <div class="xp-bar-bg">
                    <div class="xp-bar-fill" style="width: {{ xp_progress_percent }}%"></div>
                </div>
                <div class="xp-text">{{ progress.total_xp % 100 }} / 100 XP</div>
                <div class="xp-next">{{ xp_needed }} XP to Level {{ progress.current_level + 1 }}</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value">{{ progress.current_streak }}</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-value">{{ progress.longest_streak }}</div>
                <div class="stat-label">Best Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value">{{ progress.tasks_completed }}</div>
                <div class="stat-label">Total Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-value">{{ weekly_stats.completions or 0 }}</div>
                <div class="stat-label">This Week</div>
            </div>
        </div>
    </div>

    <!-- Category Balance -->
    <div class="category-section">
        <h2>üìä Life Balance (This Week)</h2>
        <p class="subtitle">Tasks completed in each category</p>
        <div class="category-grid">
            {% for category in categories %}
            <div class="category-card">
                <div class="category-name">{{ category }}</div>
                <div class="category-count">{{ category_stats.get(category, 0) }}</div>
                <div class="category-bar-bg">
                    {% set max_count = category_stats.values()|max if category_stats.values()|list else 1 %}
                    {% set percentage = (category_stats.get(category, 0) / max_count * 100) if max_count > 0 else 0 %}
                    <div class="category-bar-fill" style="width: {{ percentage }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Today's Completions -->
    {% if todays_completions %}
    <div class="completions-section">
        <h2>‚ú® Completed Today</h2>
        <div class="completions-list">
            {% for completion in todays_completions %}
            <div class="completion-item">
                <span class="completion-check">‚úì</span>
                <div class="completion-info">
                    <span class="completion-title">{{ completion.title }}</span>
                    <span class="completion-category">{{ completion.category }}</span>
                </div>
                <div class="completion-meta">
                    {% if completion.tier_completed == 'high' %}
                    <span class="tier-badge high">üî• High</span>
                    {% elif completion.tier_completed == 'medium' %}
                    <span class="tier-badge medium">‚ö° Medium</span>
                    {% else %}
                    <span class="tier-badge low">üåô Low</span>
                    {% endif %}
                    <span class="completion-points">+{{ completion.points_earned }} XP</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Quick Quest Select -->
    <div class="quick-select">
        <h2>üéØ Quick Quest Select</h2>
        <p class="subtitle">Choose quests based on how you're feeling:</p>
        <div class="mood-buttons">
            <a href="{{ url_for('quest_select') }}?energy=high" class="mood-btn high-energy">
                üî• High Energy
            </a>
            <a href="{{ url_for('quest_select') }}?energy=medium" class="mood-btn medium-energy">
                ‚ö° Medium Energy
            </a>
            <a href="{{ url_for('quest_select') }}?energy=low" class="mood-btn low-energy">
                üåô Low Energy
            </a>
        </div>
    </div>

    <!-- Task Overview -->
    <div class="tasks-overview">
        <div class="task-category">
            <h3>üìÜ Daily Tasks <span class="task-count">{{ daily_tasks|length }}</span></h3>
            <div class="task-list">
                {% for task in daily_tasks[:5] %}
                <div class="task-item">
                    <div class="task-info">
                        <div class="task-title">{{ task.title }}</div>
                        <div class="task-subtitle">{{ task.category }}</div>
                        <div class="task-tags">
                            {% if task.effort_type %}
                            <span class="tag tag-effort">{{ task.effort_type }}</span>
                            {% endif %}
                            {% if task.location_type %}
                            <span class="tag tag-location">{{ task.location_type }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="task-actions">
                        <span class="task-points-range">{{ task.low_points }}-{{ task.high_points }} XP</span>
                        <a href="{{ url_for('task_detail', task_id=task.id) }}" class="btn-complete">‚úì</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="task-category">
            <h3>üîÑ Weekly Tasks <span class="task-count">{{ weekly_tasks|length }}</span></h3>
            <div class="task-list">
                {% for task in weekly_tasks[:5] %}
                <div class="task-item">
                    <div class="task-info">
                        <div class="task-title">{{ task.title }}</div>
                        <div class="task-subtitle">{{ task.category }}</div>
                        <div class="task-tags">
                            {% if task.effort_type %}
                            <span class="tag tag-effort">{{ task.effort_type }}</span>
                            {% endif %}
                            {% if task.location_type %}
                            <span class="tag tag-location">{{ task.location_type }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="task-actions">
                        <span class="task-points-range">{{ task.low_points }}-{{ task.high_points }} XP</span>
                        <a href="{{ url_for('task_detail', task_id=task.id) }}" class="btn-complete">‚úì</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="task-category">
            <h3>‚≠ê Bonus Tasks <span class="task-count">{{ bonus_tasks|length }}</span></h3>
            <div class="task-list">
                {% for task in bonus_tasks[:5] %}
                <div class="task-item">
                    <div class="task-info">
                        <div class="task-title">{{ task.title }}</div>
                        <div class="task-subtitle">{{ task.category }}</div>
                        <div class="task-tags">
                            {% if task.effort_type %}
                            <span class="tag tag-effort">{{ task.effort_type }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="task-actions">
                        <span class="task-points-range">{{ task.low_points }}-{{ task.high_points }} XP</span>
                        <a href="{{ url_for('task_detail', task_id=task.id) }}" class="btn-complete">‚úì</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div id="notification" class="notification"></div>
{% endblock %}